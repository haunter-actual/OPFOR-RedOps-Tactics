# Linux Privilege Escalation - Recon


[Users, Processes, & Directory Enumeration](#user--process-enumeration)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[Current User](#User)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[Other Users](#Other-Users)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[SUID & SGID](#suid--sgid)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[Passwords & Hashes](#passwords--hashes)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[Processes](#processes)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[Services, Packages, & Binaries](#services-packages--binaries)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[Writable Directories & Files](#writable-directories--files)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[Interesting Directories](#interesting-directories)<br/>
[System & Environment Enumeration](#system--environment-enumeration)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[System Information](#system-information)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[Network Information](#network-information)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[File Systems, Drives, & Peripherals](#file-systems-drives--peripherals)<br/>

## User & Process Enumeration

### Current User

```bash
cat /etc/shells # Available login shells
```
```bash
whoami # Get current user context
id # what groups does the user belong to
ls -all ~/.ssh 	# Check for SSH keys for current user
lastlog # check user's last login time
```
```bash
sudo -l	# Can the user run anything as another user?
```
```bash
history	# Check the current user's bash history
tail -n5 /home/*/.bash* # Check current user's bash history
echo $PATH # Check the current user's PATH variable contents
env # Check environmental vars for the user, may find a password
cat .bashrc # Check if custom vars found
```

### Other Users

```bash
ls -alh /home	# View user home directories. Check .bash_history & .ssh/ for keys
cat /etc/passwd | cut -f1 -d: # get all users from /etc/passwd
ps au # See logged in users
w # see logged in users
finger # see logged in users
```
```bash
grep -rnw "PRIVATE KEY" /home/* 2>/dev/null | grep ":1" # SSH private keys
grep -rnw "ssh-rsa" /home/* 2>/dev/null | grep ":1" # SSH public keys
```
```bash
find / -type f \( -name *_hist -o -name *_history \) -exec ls -l {} \; 2>/dev/null # find history files
find . -print | sed -e 's;[^/]*/;|;g;s;|; |;g' # Local file enum
```

### SUID & SGID

```bash
find / -user root -perm -4000 -exec ls -ldb {} \; 2>/dev/null	# Find binaries with the SUID bit set. The file will execute with the privileges of the file group.
find / -user root -perm -6000 -exec ls -ldb {} \; 2>/dev/null	# Find binaries with the SETGID bit set. The file will execute with the privilege of the file owner.
```

### Passwords & Hashes

```bash
cat /etc/passwd # file is readable by all users, sometimes a hash will be in here. If we have the shadow file, too, then we can crack the hashes
cat /etc/shadow # if readable, then hashes for all users will be available to crack
cat /etc/group # view groups
getent group sudo # get the members of ANY group, e.g. sudo
grep 'DB_USER\|DB_PASSWORD' wp-config.php # Look for credentials
find / ! -path "*/proc/*" -iname "*config*" -type f 2>/dev/null # Look for credentials 
```

### Processes

```bash
ps au
ps aux | grep root	# See processes running as root
ps aux | grep $user # See processes running as $user
ls -la /etc/cron.daily # Check for daily Cron jobs
find / -path /proc -prune -o -type d -perm -o+w 2>/dev/null # Find world-writeable directories. Interesting dirs could be used by cron jobs that can be exploited
./pspy64 -pf -i 1000	# View running processes with pspy. -pf print cmds and -i 1000 refresh every 1000/ms (every second)
```

### Services, Packages, & Binaries

```bash
sudo -V # Check sudo version to see if vulnerable to exploit
ls -l /bin /usr/bin/ /usr/sbin/ # View binaries
apt list --installed | tr "/" " " | cut -d" " -f1,3 | sed 's/[0-9]://g' | tee -a installed_pkgs.list # Create a list of installed packages
for i in $(curl -s https://gtfobins.github.io/ | html2text | cut -d" " -f1 | sed '/^[[:space:]]*$/d');do if grep -q "$i" installed_pkgs.list;then echo "Check GTFO for: $i";fi;done # Search GTFObins for installed package list created above
strace ping -c1 10.129.112.20 # track and analyze system calls and signal processing. It allows us to follow the flow of a program and understand how it accesses system resources, processes signals, and receives and sends data from the operating system
```

### Writable Directories & Files

```bash
find / -path /proc -prune -o -type d -perm -o+w 2>/dev/null	# Find world-writeable directories. Interesting dirs could be used by cron jobs that can be exploited
find / -path /proc -prune -o -type f -perm -o+w 2>/dev/null	# Find world-writeable files
find / ! -path "*/proc/*" -iname "*config*" -type f 2>/dev/null	# Search for config files
find / -type f \( -name *.conf -o -name *.config \) -exec ls -l {} \; 2>/dev/null # Get all readable config files
find / -type f -name ".*" -exec ls -l {} \; 2>/dev/null | grep username # All hidden files for $username
find / -type d -name ".*" -ls 2>/dev/null # All hidden directories
find / -type f -name "*.sh" 2>/dev/null | grep -v "src\|snap\|share" # Search for scripts
```

### Interesting Directories

```bash
ls -l /tmp /var/tmp /dev/shm # View temporary files
/tmp # Data stored for up to 10 days or upon device restart
/var/tmp # Data stored for up to 30 days
```

## System & Environment Enumeration

### System Information

```bash
hostname
cat /etc/os-release # Check the OS version
cat /etc/lsb-release	# Check the OS version
uname -a	# Check the Kernel version
cat /proc/version # Check the Kernal version
lscpu # Check the CPU type/version
find /proc -name cmdline -exec cat {} \; 2>/dev/null | tr " " "\n" #  used to look up system information such as the state of running processes, kernel parameters, system memory, and devices. It also sets certain system parameters, such as process priority, scheduling, and memory allocation.
```

### Network Information

```bash
ip a # check subnets and NICs
ifconfig # check subnets and NICs
route # routing table
netstat -rn # routing table
arp -a # Check what other hosts the system has been communicating with
cat /etc/hosts # local DNS entries
```

### File Systems, Drives, & Peripherals

```bash
df -h # View mounted file systems. Root required to mount/unmount drives.
lsblk	# Check for unmounted file systems/drives. If you discover and can mount an additional drive or unmounted file system, you may find sensitive files, passwords, or backups that can be leveraged to escalate privileges.
cat /etc/fstab # search for 'password' 'username', 'credential' by grepping. Used for mounted drives
cat /etc/fstab | grep -v password # example
lpstat # Check for any attached printers for potential interesting info
cat /etc/fstab | grep -v "#" | column -t # View unmounted file systems
```
